DROP DATABASE IF EXISTS trauthsampledb;
CREATE DATABASE IF NOT EXISTS trauthsampledb;
USE trauthsampledb;

-- this is necessary when using mysql to enable foreign keys
SET storage_engine=INNODB;

-- remove the comments of the following two lines when using derby in memory data base
-- connect 'jdbc:derby:memory:derbyDB';
-- use enterprise_it_ep00;

DROP TABLE IF EXISTS ACTIONS;
DROP TABLE IF EXISTS PERMISSIONS;
DROP TABLE IF EXISTS RESOURCEGROUPS;
DROP TABLE IF EXISTS ROLES;
DROP TABLE IF EXISTS URN_RESOURCEGROUPS;
DROP TABLE IF EXISTS USERS;
DROP TABLE IF EXISTS USERS_ROLES;

CREATE TABLE ACTIONS ( NAME VARCHAR(30) NOT NULL, PRIMARY KEY (NAME) ) ;
CREATE TABLE PERMISSIONS ( ROLE_NAME VARCHAR(150) NOT NULL, ACTION_NAME VARCHAR(30) NOT NULL, RESOURCEGROUP_NAME VARCHAR(40) ) ;
CREATE TABLE RESOURCEGROUPS ( NAME VARCHAR(40) NOT NULL, PRIMARY KEY (NAME) ) ;
CREATE TABLE ROLES ( NAME VARCHAR(150) NOT NULL, PRIMARY KEY (NAME) ) ;
CREATE TABLE URN_RESOURCEGROUPS ( URN VARCHAR(255) NOT NULL, RESOURCEGROUP VARCHAR(40) NOT NULL, PRIMARY KEY (URN, RESOURCEGROUP) ) ;
CREATE TABLE USERS ( NAME VARCHAR(150) NOT NULL, PASSWORD VARCHAR(1500), SALT VARCHAR(1500), PRIMARY KEY (NAME) ) ;
CREATE TABLE USERS_ROLES ( ROLE_NAME VARCHAR(150) NOT NULL, USER_NAME VARCHAR(150) NOT NULL, PRIMARY KEY (ROLE_NAME, USER_NAME) ) ;

insert into ACTIONS (NAME) values ('RS_DELETE_RESERVATION');
insert into ACTIONS (NAME) values ('RS_GET_RESERVATIONS');
insert into ACTIONS (NAME) values ('RS_MAKE_RESERVATION');
insert into ACTIONS (NAME) values ('SM_ARE_NODES_ALIVE');
insert into ACTIONS (NAME) values ('SM_FREE');
insert into ACTIONS (NAME) values ('WSN_ARE_NODES_ALIVE');
insert into ACTIONS (NAME) values ('WSN_DESTROY_VIRTUAL_LINK');
insert into ACTIONS (NAME) values ('WSN_DISABLE_NODE');
insert into ACTIONS (NAME) values ('WSN_DISABLE_PHYSICAL_LINK');
insert into ACTIONS (NAME) values ('WSN_ENABLE_NODE');
insert into ACTIONS (NAME) values ('WSN_ENABLE_PHYSICAL_LINK');
insert into ACTIONS (NAME) values ('WSN_FLASH_PROGRAMS');
insert into ACTIONS (NAME) values ('WSN_RESET_NODES');
insert into ACTIONS (NAME) values ('WSN_SEND');
insert into ACTIONS (NAME) values ('WSN_SET_CHANNEL_PIPELINE');
insert into ACTIONS (NAME) values ('WSN_SET_VIRTUAL_LINK');
insert into ACTIONS (NAME) values ('WSN_SUBSCRIBE');
insert into ACTIONS (NAME) values ('*');

insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('ADMINISTRATOR', '*', 'EXPERIMENT_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('ADMINISTRATOR', '*', 'SERVICE_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('ADMINISTRATOR', '*', 'SERVICE_AND_EXPERIMENT_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('EXPERIMENTER', 'RS_DELETE_RESERVATION', 'EXPERIMENT_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('EXPERIMENTER', 'RS_DELETE_RESERVATION', 'EXPERIMENT_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('EXPERIMENTER', 'RS_GET_RESERVATIONS', 'EXPERIMENT_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('EXPERIMENTER', 'RS_MAKE_RESERVATION', 'EXPERIMENT_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('EXPERIMENTER', 'SM_ARE_NODES_ALIVE', 'EXPERIMENT_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('EXPERIMENTER', 'SM_FREE', 'EXPERIMENT_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('EXPERIMENTER', 'WSN_ARE_NODES_ALIVE', 'EXPERIMENT_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('EXPERIMENTER', 'WSN_DESTROY_VIRTUAL_LINK', 'EXPERIMENT_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('EXPERIMENTER', 'WSN_DISABLE_NODE', 'EXPERIMENT_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('EXPERIMENTER', 'WSN_DISABLE_PHYSICAL_LINK', 'EXPERIMENT_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('EXPERIMENTER', 'WSN_ENABLE_NODE', 'EXPERIMENT_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('EXPERIMENTER', 'WSN_ENABLE_PHYSICAL_LINK', 'EXPERIMENT_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('EXPERIMENTER', 'WSN_FLASH_PROGRAMS', 'EXPERIMENT_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('EXPERIMENTER', 'WSN_RESET_NODES', 'EXPERIMENT_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('EXPERIMENTER', 'WSN_SEND', 'EXPERIMENT_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('EXPERIMENTER', 'WSN_SET_CHANNEL_PIPELINE', 'EXPERIMENT_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('EXPERIMENTER', 'WSN_SET_VIRTUAL_LINK', 'EXPERIMENT_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('SERVICE_PROVIDER', 'RS_DELETE_RESERVATION', 'SERVICE_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('SERVICE_PROVIDER', 'RS_MAKE_RESERVATION', 'SERVICE_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('SERVICE_PROVIDER', 'SM_ARE_NODES_ALIVE', 'SERVICE_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('SERVICE_PROVIDER', 'WSN_ARE_NODES_ALIVE', 'SERVICE_ONLY_NODES');
insert into PERMISSIONS (ROLE_NAME, ACTION_NAME, RESOURCEGROUP_NAME) values ('SERVICE_PROVIDER', 'WSN_SEND', 'SERVICE_ONLY_NODES');

insert into RESOURCEGROUPS (NAME) values ('EXPERIMENT_ONLY_NODES');
insert into RESOURCEGROUPS (NAME) values ('SERVICE_ONLY_NODES');
insert into RESOURCEGROUPS (NAME) values ('SERVICE_AND_EXPERIMENT_NODES');
insert into RESOURCEGROUPS (NAME) values ('*');

insert into ROLES (NAME) values ('ADMINISTRATOR');
insert into ROLES (NAME) values ('EXPERIMENTER');
insert into ROLES (NAME) values ('SERVICE_PROVIDER');

insert into URN_RESOURCEGROUPS (URN, RESOURCEGROUP) values ('urn:wisebed:ulanc1:0x1211', 'EXPERIMENT_ONLY_NODES');
insert into URN_RESOURCEGROUPS (URN, RESOURCEGROUP) values ('urn:wisebed:ulanc1:0x1212', 'EXPERIMENT_ONLY_NODES');
insert into URN_RESOURCEGROUPS (URN, RESOURCEGROUP) values ('urn:wisebed:ulanc1:0x1213', 'EXPERIMENT_ONLY_NODES');
insert into URN_RESOURCEGROUPS (URN, RESOURCEGROUP) values ('urn:wisebed:ulanc1:0x1311', 'SERVICE_ONLY_NODES');
insert into URN_RESOURCEGROUPS (URN, RESOURCEGROUP) values ('urn:wisebed:ulanc1:0x1312', 'SERVICE_ONLY_NODES');
insert into URN_RESOURCEGROUPS (URN, RESOURCEGROUP) values ('urn:wisebed:ulanc1:0x1313', 'SERVICE_ONLY_NODES');
insert into URN_RESOURCEGROUPS (URN, RESOURCEGROUP) values ('urn:wisebed:uzl2:0x2211', 'EXPERIMENT_ONLY_NODES');
insert into URN_RESOURCEGROUPS (URN, RESOURCEGROUP) values ('urn:wisebed:uzl2:0x2212', 'EXPERIMENT_ONLY_NODES');
insert into URN_RESOURCEGROUPS (URN, RESOURCEGROUP) values ('urn:wisebed:uzl2:0x2213', 'EXPERIMENT_ONLY_NODES');
insert into URN_RESOURCEGROUPS (URN, RESOURCEGROUP) values ('urn:wisebed:uzl2:0x2311', 'SERVICE_ONLY_NODES');
insert into URN_RESOURCEGROUPS (URN, RESOURCEGROUP) values ('urn:wisebed:uzl2:0x2312', 'SERVICE_ONLY_NODES');
insert into URN_RESOURCEGROUPS (URN, RESOURCEGROUP) values ('urn:wisebed:uzl2:0x2313', 'SERVICE_ONLY_NODES');

insert into USERS (NAME, PASSWORD, SALT) values ('Experimenter1', '3c5f7e3007fdd9d8fa385b0f1fda8232d9a8aaab453cbfe50c603854e930e5d0ab622f0ac0afca1e28360c40f87a76f6a60794d81ffb95463c9ff2452b6547d0', 'Exp1Salt');
insert into USERS (NAME, PASSWORD, SALT) values ('Administrator1', 'bfe64d862cf28eb946d8575c04689e1a17ea8e4b8ee74ce7ec291a076a48631a3b2bb55369c456f9c3497c420d87c95639fc72edb223c38509e04f526556069a', 'Adm1Salt');
insert into USERS (NAME, PASSWORD, SALT) values ('ServiceProvider1', '11da89a16de249a3f89ff1a55b17c31539cc3b675fd7c3e4e9475869bef8e9420593efd841eb8cee6e86526fb72f4d7e7f2ac715ee3d4e3044f3af1f397923d2', 'SP1PSalt');

insert into USERS_ROLES (ROLE_NAME, USER_NAME) values ('ADMINISTRATOR', 'Administrator1');
insert into USERS_ROLES (ROLE_NAME, USER_NAME) values ('EXPERIMENTER', 'Experimenter1');
insert into USERS_ROLES (ROLE_NAME, USER_NAME) values ('SERVICE_PROVIDER', 'ServiceProvider1');

ALTER TABLE PERMISSIONS ADD CONSTRAINT PERMISSIONS_FK1 FOREIGN KEY (ROLE_NAME) REFERENCES ROLES (NAME);
ALTER TABLE PERMISSIONS ADD CONSTRAINT PERMISSIONS_FK2 FOREIGN KEY (ACTION_NAME) REFERENCES ACTIONS (NAME);
ALTER TABLE PERMISSIONS ADD CONSTRAINT PERMISSIONS_FK3 FOREIGN KEY (RESOURCEGROUP_NAME) REFERENCES RESOURCEGROUPS (NAME);
ALTER TABLE URN_RESOURCEGROUPS ADD CONSTRAINT URN_RESOURCEGROUPS_FK1 FOREIGN KEY (RESOURCEGROUP) REFERENCES RESOURCEGROUPS (NAME);
ALTER TABLE USERS_ROLES ADD CONSTRAINT USERS_ROLES_FK2 FOREIGN KEY (USER_NAME) REFERENCES USERS (NAME);
ALTER TABLE USERS_ROLES ADD CONSTRAINT USERS_ROLES_FK3 FOREIGN KEY (ROLE_NAME) REFERENCES ROLES (NAME);

DROP USER 'trauthuser'@'localhost';
CREATE USER 'trauthuser'@'localhost' IDENTIFIED BY 'trauthuser';
GRANT ALL PRIVILEGES ON trauthsampledb.* TO 'trauthuser'@'localhost';

-- remove the comments of the following two lines when using derby in memory data base
-- commit;
-- disconnect all;
