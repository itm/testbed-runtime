<html><head><title>Manuel d&#39;Installation</title><style type="text/css">.lst-kix_3qlgdhcge1u2-0>li:before{content:"\0025cf  "}.lst-kix_2sf0z1y7x5zk-1>li:before{content:"\0025cb  "}.lst-kix_ctchon721dqn-8>li:before{content:"\0025a0  "}.lst-kix_ctchon721dqn-7>li:before{content:"\0025cb  "}.lst-kix_2sf0z1y7x5zk-8>li:before{content:"\0025a0  "}.lst-kix_bq353woles44-5>li:before{content:"\0025a0  "}.lst-kix_bq353woles44-4>li:before{content:"\0025cb  "}.lst-kix_ctchon721dqn-5>li:before{content:"\0025a0  "}.lst-kix_bq353woles44-8>li:before{content:"\0025a0  "}.lst-kix_e6tztbxvjfqw-6>li:before{content:"\0025cf  "}.lst-kix_bq353woles44-6>li:before{content:"\0025cf  "}.lst-kix_j6d7l5589ltw-0>li:before{content:"\0025cf  "}.lst-kix_y8a9v7na1ktp-8>li:before{content:"\0025a0  "}.lst-kix_bu14vpjvdd28-3>li:before{content:"\0025cf  "}.lst-kix_y8a9v7na1ktp-6>li:before{content:"\0025cf  "}.lst-kix_1lixzt95953h-2>li:before{content:"\0025a0  "}.lst-kix_w1tbo0uw0dzo-2>li:before{content:"\0025a0  "}.lst-kix_j6d7l5589ltw-6>li:before{content:"\0025cf  "}.lst-kix_q0u5vqmi6mso-8>li:before{content:"\0025a0  "}.lst-kix_j6d7l5589ltw-7>li:before{content:"\0025cb  "}.lst-kix_j6d7l5589ltw-2>li:before{content:"\0025a0  "}.lst-kix_y8a9v7na1ktp-1>li:before{content:"\0025cb  "}.lst-kix_kp8mdtyzptu4-0>li:before{content:"\0025cf  "}.lst-kix_bq353woles44-0>li:before{content:"\0025cf  "}.lst-kix_rb6qn9l2j41t-2>li:before{content:"\0025a0  "}.lst-kix_bq353woles44-2>li:before{content:"\0025a0  "}.lst-kix_tzgaldej7e3l-3>li:before{content:"\0025cf  "}.lst-kix_ku36k0n49ut4-8>li:before{content:"\0025a0  "}.lst-kix_redw3bbeip64-5>li:before{content:"\0025a0  "}.lst-kix_redw3bbeip64-8>li:before{content:"\0025a0  "}.lst-kix_1lixzt95953h-1>li:before{content:"\0025cb  "}.lst-kix_y8a9v7na1ktp-5>li:before{content:"\0025a0  "}.lst-kix_bu14vpjvdd28-0>li:before{content:"\0025cf  "}.lst-kix_e6tztbxvjfqw-0>li:before{content:"\0025cf  "}.lst-kix_j6d7l5589ltw-5>li:before{content:"\0025a0  "}.lst-kix_tr3a5mrn38l1-5>li:before{content:"\0025a0  "}.lst-kix_1lixzt95953h-4>li:before{content:"\0025cb  "}.lst-kix_rb6qn9l2j41t-6>li:before{content:"\0025cf  "}.lst-kix_kp8mdtyzptu4-2>li:before{content:"\0025a0  "}.lst-kix_omaqlsvmsq3h-0>li:before{content:"\0025cf  "}.lst-kix_kp8mdtyzptu4-7>li:before{content:"\0025cb  "}.lst-kix_e6tztbxvjfqw-1>li:before{content:"\0025cb  "}.lst-kix_tzgaldej7e3l-4>li:before{content:"\0025cb  "}.lst-kix_tzgaldej7e3l-1>li:before{content:"\0025cb  "}.lst-kix_ku36k0n49ut4-2>li:before{content:"\0025a0  "}.lst-kix_rb6qn9l2j41t-4>li:before{content:"\0025cb  "}.lst-kix_ctchon721dqn-3>li:before{content:"\0025cf  "}.lst-kix_tzgaldej7e3l-5>li:before{content:"\0025a0  "}.lst-kix_e6tztbxvjfqw-8>li:before{content:"\0025a0  "}.lst-kix_redw3bbeip64-3>li:before{content:"\0025cf  "}.lst-kix_kp8mdtyzptu4-3>li:before{content:"\0025cf  "}.lst-kix_tr3a5mrn38l1-6>li:before{content:"\0025cf  "}.lst-kix_q0u5vqmi6mso-5>li:before{content:"\0025a0  "}.lst-kix_kp8mdtyzptu4-5>li:before{content:"\0025a0  "}.lst-kix_ctchon721dqn-1>li:before{content:"\0025cb  "}.lst-kix_gxulxpcr6ths-7>li:before{content:"\0025cb  "}.lst-kix_rb6qn9l2j41t-8>li:before{content:"\0025a0  "}.lst-kix_tr3a5mrn38l1-4>li:before{content:"\0025cb  "}.lst-kix_ctchon721dqn-0>li:before{content:"\0025cf  "}.lst-kix_nqgj00cp0ike-5>li:before{content:"\0025a0  "}.lst-kix_redw3bbeip64-7>li:before{content:"\0025cb  "}.lst-kix_3qlgdhcge1u2-8>li:before{content:"\0025a0  "}.lst-kix_w1tbo0uw0dzo-5>li:before{content:"\0025a0  "}.lst-kix_gxulxpcr6ths-2>li:before{content:"\0025a0  "}.lst-kix_tr3a5mrn38l1-2>li:before{content:"\0025a0  "}.lst-kix_bu14vpjvdd28-6>li:before{content:"\0025cf  "}.lst-kix_gxulxpcr6ths-8>li:before{content:"\0025a0  "}.lst-kix_kp8mdtyzptu4-6>li:before{content:"\0025cf  "}.lst-kix_omaqlsvmsq3h-4>li:before{content:"\0025cb  "}.lst-kix_rb6qn9l2j41t-0>li:before{content:"\0025cf  "}.lst-kix_q0u5vqmi6mso-3>li:before{content:"\0025cf  "}.lst-kix_omaqlsvmsq3h-2>li:before{content:"\0025a0  "}.lst-kix_hwmjnevpktkm-2>li:before{content:"\0025a0  "}.lst-kix_tr3a5mrn38l1-8>li:before{content:"\0025a0  "}.lst-kix_bq353woles44-3>li:before{content:"\0025cf  "}.lst-kix_redw3bbeip64-1>li:before{content:"\0025cb  "}.lst-kix_ku36k0n49ut4-6>li:before{content:"\0025cf  "}.lst-kix_w1tbo0uw0dzo-4>li:before{content:"\0025cb  "}.lst-kix_hwmjnevpktkm-7>li:before{content:"\0025cb  "}.lst-kix_2sf0z1y7x5zk-2>li:before{content:"\0025a0  "}.lst-kix_e6tztbxvjfqw-3>li:before{content:"\0025cf  "}.lst-kix_ctchon721dqn-6>li:before{content:"\0025cf  "}.lst-kix_tr3a5mrn38l1-1>li:before{content:"\0025cb  "}.lst-kix_2sf0z1y7x5zk-7>li:before{content:"\0025cb  "}.lst-kix_nqgj00cp0ike-1>li:before{content:"\0025cb  "}.lst-kix_w1tbo0uw0dzo-7>li:before{content:"\0025cb  "}.lst-kix_bu14vpjvdd28-1>li:before{content:"\0025cb  "}.lst-kix_bu14vpjvdd28-7>li:before{content:"\0025cb  "}.lst-kix_hwmjnevpktkm-5>li:before{content:"\0025a0  "}.lst-kix_q0u5vqmi6mso-2>li:before{content:"\0025a0  "}.lst-kix_tzgaldej7e3l-7>li:before{content:"\0025cb  "}.lst-kix_tr3a5mrn38l1-0>li:before{content:"\0025cf  "}.lst-kix_3qlgdhcge1u2-7>li:before{content:"\0025cb  "}.lst-kix_tr3a5mrn38l1-7>li:before{content:"\0025cb  "}.lst-kix_2sf0z1y7x5zk-4>li:before{content:"\0025cb  "}.lst-kix_y8a9v7na1ktp-7>li:before{content:"\0025cb  "}.lst-kix_y8a9v7na1ktp-2>li:before{content:"\0025a0  "}.lst-kix_hwmjnevpktkm-1>li:before{content:"\0025cb  "}.lst-kix_hwmjnevpktkm-3>li:before{content:"\0025cf  "}.lst-kix_nqgj00cp0ike-7>li:before{content:"\0025cb  "}.lst-kix_q0u5vqmi6mso-1>li:before{content:"\0025cb  "}.lst-kix_gxulxpcr6ths-3>li:before{content:"\0025cf  "}.lst-kix_tzgaldej7e3l-8>li:before{content:"\0025a0  "}.lst-kix_1lixzt95953h-6>li:before{content:"\0025cf  "}.lst-kix_tr3a5mrn38l1-3>li:before{content:"\0025cf  "}.lst-kix_w1tbo0uw0dzo-8>li:before{content:"\0025a0  "}.lst-kix_1lixzt95953h-0>li:before{content:"\0025cf  "}.lst-kix_gxulxpcr6ths-4>li:before{content:"\0025cb  "}.lst-kix_redw3bbeip64-2>li:before{content:"\0025a0  "}.lst-kix_tzgaldej7e3l-2>li:before{content:"\0025a0  "}.lst-kix_3qlgdhcge1u2-5>li:before{content:"\0025a0  "}.lst-kix_tzgaldej7e3l-0>li:before{content:"\0025cf  "}.lst-kix_2sf0z1y7x5zk-6>li:before{content:"\0025cf  "}.lst-kix_j6d7l5589ltw-4>li:before{content:"\0025cb  "}.lst-kix_1lixzt95953h-3>li:before{content:"\0025cf  "}.lst-kix_j6d7l5589ltw-8>li:before{content:"\0025a0  "}.lst-kix_y8a9v7na1ktp-4>li:before{content:"\0025cb  "}.lst-kix_3qlgdhcge1u2-3>li:before{content:"\0025cf  "}.lst-kix_bq353woles44-7>li:before{content:"\0025cb  "}.lst-kix_hwmjnevpktkm-6>li:before{content:"\0025cf  "}.lst-kix_omaqlsvmsq3h-5>li:before{content:"\0025a0  "}.lst-kix_omaqlsvmsq3h-3>li:before{content:"\0025cf  "}.lst-kix_y8a9v7na1ktp-0>li:before{content:"\0025cf  "}.lst-kix_nqgj00cp0ike-0>li:before{content:"\0025cf  "}.lst-kix_redw3bbeip64-0>li:before{content:"\0025cf  "}.lst-kix_gxulxpcr6ths-6>li:before{content:"\0025cf  "}.lst-kix_ctchon721dqn-2>li:before{content:"\0025a0  "}.lst-kix_ctchon721dqn-4>li:before{content:"\0025cb  "}.lst-kix_nqgj00cp0ike-6>li:before{content:"\0025cf  "}.lst-kix_3qlgdhcge1u2-6>li:before{content:"\0025cf  "}.lst-kix_y8a9v7na1ktp-3>li:before{content:"\0025cf  "}.lst-kix_gxulxpcr6ths-0>li:before{content:"\0025cf  "}.lst-kix_hwmjnevpktkm-8>li:before{content:"\0025a0  "}.lst-kix_ku36k0n49ut4-4>li:before{content:"\0025cb  "}.lst-kix_1lixzt95953h-5>li:before{content:"\0025a0  "}.lst-kix_q0u5vqmi6mso-4>li:before{content:"\0025cb  "}.lst-kix_rb6qn9l2j41t-1>li:before{content:"\0025cb  "}.lst-kix_2sf0z1y7x5zk-5>li:before{content:"\0025a0  "}.lst-kix_kp8mdtyzptu4-1>li:before{content:"\0025cb  "}.lst-kix_e6tztbxvjfqw-5>li:before{content:"\0025a0  "}.lst-kix_w1tbo0uw0dzo-3>li:before{content:"\0025cf  "}.lst-kix_e6tztbxvjfqw-7>li:before{content:"\0025cb  "}.lst-kix_gxulxpcr6ths-1>li:before{content:"\0025cb  "}.lst-kix_redw3bbeip64-6>li:before{content:"\0025cf  "}.lst-kix_q0u5vqmi6mso-0>li:before{content:"\0025cf  "}.lst-kix_bu14vpjvdd28-8>li:before{content:"\0025a0  "}.lst-kix_hwmjnevpktkm-0>li:before{content:"\0025cf  "}.lst-kix_1lixzt95953h-8>li:before{content:"\0025a0  "}.lst-kix_ku36k0n49ut4-5>li:before{content:"\0025a0  "}.lst-kix_ku36k0n49ut4-0>li:before{content:"\0025cf  "}.lst-kix_3qlgdhcge1u2-4>li:before{content:"\0025cb  "}.lst-kix_q0u5vqmi6mso-7>li:before{content:"\0025cb  "}.lst-kix_w1tbo0uw0dzo-1>li:before{content:"\0025cb  "}.lst-kix_rb6qn9l2j41t-7>li:before{content:"\0025cb  "}.lst-kix_bu14vpjvdd28-4>li:before{content:"\0025cb  "}.lst-kix_1lixzt95953h-7>li:before{content:"\0025cb  "}.lst-kix_3qlgdhcge1u2-1>li:before{content:"\0025cb  "}.lst-kix_rb6qn9l2j41t-3>li:before{content:"\0025cf  "}.lst-kix_j6d7l5589ltw-3>li:before{content:"\0025cf  "}.lst-kix_j6d7l5589ltw-1>li:before{content:"\0025cb  "}.lst-kix_bq353woles44-1>li:before{content:"\0025cb  "}.lst-kix_gxulxpcr6ths-5>li:before{content:"\0025a0  "}.lst-kix_w1tbo0uw0dzo-6>li:before{content:"\0025cf  "}.lst-kix_omaqlsvmsq3h-1>li:before{content:"\0025cb  "}.lst-kix_nqgj00cp0ike-4>li:before{content:"\0025cb  "}.lst-kix_omaqlsvmsq3h-6>li:before{content:"\0025cf  "}.lst-kix_redw3bbeip64-4>li:before{content:"\0025cb  "}.lst-kix_q0u5vqmi6mso-6>li:before{content:"\0025cf  "}.lst-kix_bu14vpjvdd28-2>li:before{content:"\0025a0  "}.lst-kix_rb6qn9l2j41t-5>li:before{content:"\0025a0  "}.lst-kix_3qlgdhcge1u2-2>li:before{content:"\0025a0  "}.lst-kix_nqgj00cp0ike-2>li:before{content:"\0025a0  "}.lst-kix_ku36k0n49ut4-3>li:before{content:"\0025cf  "}.lst-kix_kp8mdtyzptu4-4>li:before{content:"\0025cb  "}.lst-kix_omaqlsvmsq3h-7>li:before{content:"\0025cb  "}.lst-kix_omaqlsvmsq3h-8>li:before{content:"\0025a0  "}.lst-kix_kp8mdtyzptu4-8>li:before{content:"\0025a0  "}.lst-kix_ku36k0n49ut4-1>li:before{content:"\0025cb  "}.lst-kix_w1tbo0uw0dzo-0>li:before{content:"\0025cf  "}.lst-kix_nqgj00cp0ike-3>li:before{content:"\0025cf  "}.lst-kix_2sf0z1y7x5zk-0>li:before{content:"\0025cf  "}.lst-kix_nqgj00cp0ike-8>li:before{content:"\0025a0  "}.lst-kix_tzgaldej7e3l-6>li:before{content:"\0025cf  "}.lst-kix_e6tztbxvjfqw-2>li:before{content:"\0025a0  "}.lst-kix_e6tztbxvjfqw-4>li:before{content:"\0025cb  "}.lst-kix_hwmjnevpktkm-4>li:before{content:"\0025cb  "}.lst-kix_2sf0z1y7x5zk-3>li:before{content:"\0025cf  "}.lst-kix_bu14vpjvdd28-5>li:before{content:"\0025a0  "}.lst-kix_ku36k0n49ut4-7>li:before{content:"\0025cb  "}ol{margin:0;padding:0}.c3{list-style-type:none;margin:0;padding:0}.c14{max-width:468pt;background-color:#ffffff;padding:72pt 72pt 72pt 72pt}.c13{color:inherit;text-decoration:inherit}.c15{font-size:13pt;font-family:"Trebuchet MS"}.c1{font-size:8pt}.c12{color:#1155cc}.c8{padding-left:0pt}.c4{height:11pt}.c2{margin-left:36pt}.c7{text-align:center}.c5{font-weight:bold}.c9{text-indent:36pt}.c11{height:16pt}.c10{margin-left:108pt}.c6{margin-left:72pt}.c0{direction:ltr}.c16{text-decoration:underline}.title{padding-top:0pt;line-height:1.15;text-align:left;color:#000000;font-size:21pt;font-family:"Trebuchet MS";padding-bottom:0pt}.subtitle{padding-top:0pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:13pt;font-family:"Trebuchet MS";padding-bottom:10pt}li{color:#000000;font-size:11pt;font-family:"Arial"}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{padding-top:10pt;line-height:1.15;text-align:left;color:#000000;font-size:16pt;font-family:"Trebuchet MS";padding-bottom:0pt}h2{padding-top:10pt;line-height:1.15;text-align:left;color:#000000;font-size:13pt;font-family:"Trebuchet MS";font-weight:bold;padding-bottom:0pt}h3{padding-top:8pt;line-height:1.15;text-align:left;color:#666666;font-size:12pt;font-family:"Trebuchet MS";font-weight:bold;padding-bottom:0pt}h4{padding-top:8pt;line-height:1.15;text-align:left;color:#666666;font-size:11pt;text-decoration:underline;font-family:"Trebuchet MS";padding-bottom:0pt}h5{padding-top:8pt;line-height:1.15;text-align:left;color:#666666;font-size:11pt;font-family:"Trebuchet MS";padding-bottom:0pt}h6{padding-top:8pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Trebuchet MS";padding-bottom:0pt}</style></head><body class="c14"><p class="c0"><span>Date: august 9th 2013</span></p><p class="c0"><span>Author: Nguyen Kim Thuat (CEA LIST)</span></p><p class="c4 c0"><span></span></p><p class="c0 c7 title"><a name="h.hoew94mtufmx"></a><span>Installation document</span></p><h1 class="c0 c11"><a name="h.fzz5o9dkeemx"></a></h1><h1 class="c0"><a name="h.ic62ii5gvt0k"></a><span>Overview</span></h1><p class="c4 c0"><span></span></p><p class="c0"><span>This document explains how to use the SNAA implementation based on certificate&rsquo;s approach. Our modification to the testbed code base has three main components:</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>- An SNAA implementation that is called SNAACertificate, that is similar to ShiroSNAA, and that is consistent with the certificate extension for authentication and authorization, which can be found at: </span></p><p class="c0"><span>/testbed-runtime/snaa/src/main/java/eu/smartsantander/cea/certificate/*</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>- An organization service implementation, that is servlet-based, and that the organization administrator(s) should run on his (their) organization behalf. It can be found at:</span></p><p class="c0"><span>/testbed-runtime/organization-service/*</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>- client-certificate: A library for developing clients that are consistent with the above organization service and SNAACertificate (and that is including a simple client for tests) and</span></p><p class="c0"><span>it is located at:</span></p><p class="c0"><span>/testbed-runtime/client-certificate</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>At this document&rsquo;s date, the above implementation are only available at https://github.com/pierre128 where a fork of https://github.com/itm/testbed-runtime/ has been done (a pull request to this later project is pending). </span></p><h1 class="c11 c0"><a name="h.oinv852wqpe"></a></h1><h1 class="c0"><a name="h.hbmboz7fy7l5"></a><span>Installing the application</span></h1><h2 class="c0"><a name="h.ghdu637z2em7"></a><span>1. Required Software</span></h2><p class="c0"><span>The following software is required to run the test cases using this implementation:</span></p><p class="c0"><span>- Java platform, standard edition </span></p><p class="c0"><span>- Maven (version 3.04+)</span></p><p class="c0"><span>- Glassfish server, version 3.1+</span></p><p class="c4 c0"><span></span></p><h2 class="c0"><a name="h.l7es24j8lud5"></a><span>2. Database configuration</span></h2><p class="c0"><span>It is necessary to create two database before running the test cases. One database is used for the SNAACertificate implementation, the other is used for the organization. The</span><span>se</span><span>&nbsp;scripts can be found at: </span></p><p class="c0"><span>- /testbed-runtime/snaa/src/main/resources/create_shiro_db.sql</span></p><p class="c0"><span>- /testbed-runtime/organization-service/src/main/resources/idpDB.sql</span></p><h2 class="c0"><a name="h.je2mgn9nhgnv"></a><span>3. Testing the SNAACertificate implementation</span></h2><h3 class="c0"><a name="h.sa0mhrwem2rr"></a><span>3.1 Test scenario</span></h3><p class="c0"><span>In our scenario, we defined a simple organization, which of name is &ldquo;Organization1&rdquo;. This organization has three user: Administrator1, Experimenter1, ServiceProvider1 who have relatively the roles: ADMNISTRATOR, EXPERIMENTER and SERVICEPROVIDER.</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>The testbed has already saved an example of organization certificate, which is stored in the directory /snaa/certs/Organization1/organization.cer</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>The directory /testbed-runtime/snaa/certs contains also an example of keystore and truststore. The keystore contains the key pairs which are used to generate the organization certificate. On the other hand, the trust store contains all the certificate that the testbed trusts. The detailed steps for generating the organization certificate can be found at section 4 of this document.</span></p><h3 class="c0"><a name="h.2cdtrw1171e4"></a><span>3.2 Installing components</span></h3><p class="c4 c0"><span></span></p><ol class="c3 lst-kix_ku36k0n49ut4-0 start"><li class="c8 c2 c0"><span class="c5">client-certificate:</span><span>&nbsp;This library is an independent maven project, it is used by snaa and the organization service, so it must be packaged in a single jar by using this command: </span></li></ol><p class="c6 c0"><span>mvn clean install </span></p><p class="c9 c0"><span>This jar file will be referenced in the pom.xml of the snaa module and organization-service module by adding this dependency:</span></p><p class="c4 c9 c6 c0"><span></span></p><p class="c6 c0"><span>&lt;dependency&gt;</span></p><p class="c6 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;fr.cea.util&lt;/groupId&gt;</span></p><p class="c6 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;client-certificate&lt;/artifactId&gt;</span></p><p class="c6 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span></p><p class="c6 c0"><span>&lt;/dependency&gt;</span></p><p class="c4 c9 c0"><span></span></p><ol class="c3 lst-kix_bu14vpjvdd28-0 start"><li class="c8 c2 c0"><span class="c5">organization-service:</span><span>&nbsp;This module can be deployed in any web server. In our example, it is deployed in the Glassfish server by using the embedded-glassfish maven plugin.</span></li></ol><p class="c2 c0"><span>Make sure that the glassfish server is installed and started. To start the GlassFish Server from the command line, open a terminal window or command prompt and execute the following:</span></p><p class="c4 c2 c0"><span></span></p><p class="c2 c9 c0"><span>asadmin start-domain --verbose</span></p><p class="c2 c9 c0"><span>(asadmin is located at ../glassfish3/bin)</span></p><p class="c4 c9 c0"><span></span></p><p class="c0 c9"><span>We can run the organization service by using this command: </span></p><p class="c6 c0"><span>mvn embedded-glassfish:run</span></p><p class="c4 c2 c0"><span></span></p><p class="c2 c0"><span>Besides, this plugin is also useful to deploy, undeploy the application with these similar commands:</span></p><p class="c9 c0"><span>&nbsp;</span></p><p class="c6 c0"><span>mvn embedded-glassfish:deploy, mvn embedbbed-glassfish:undeploy</span></p><p class="c4 c7 c9 c0"><span></span></p><p class="c2 c0"><span>To verify that the service is online, enter this url in the browser:</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c12 c16"><a class="c13" href="http://localhost:8088/organization-service/">http://localhost:8088/organization-service/</a></span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if you are using tomcat, it is also easy to deploy the application with the help of tomcat maven plugin. There are three things thay you have to do:</span></p><p class="c4 c0"><span></span></p><ol class="c3 lst-kix_e6tztbxvjfqw-1 start"><li class="c8 c6 c0"><span>Make sure that you have an user with administrator access right for Tomcat. To add Tomcat user, edit this file &ndash; &ldquo;%TOMCAT_PATH%/conf/tomcat-users.xml&ldquo;:</span></li></ol><p class="c0 c10"><span>&lt;?xml version=&#39;1.0&#39; encoding=&#39;utf-8&#39;?&gt;<br>&lt;tomcat-users&gt;<br> &nbsp;&lt;role rolename=&quot;manager&quot;/&gt;<br> &nbsp;&lt;role rolename=&quot;admin&quot;/&gt;<br> &nbsp;&lt;user username=&quot;admin&quot; password=&quot;admin&quot; roles=&quot;admin,manager&quot;/&gt;<br>&lt;/tomcat-users&gt;</span></p><p class="c4 c2 c0"><span></span></p><ol class="c3 lst-kix_3qlgdhcge1u2-1 start"><li class="c8 c6 c0"><span>In Maven side, you need to add the same user authentication information in &ldquo;%MAVEN_PATH%/conf/settings.xml&ldquo;:</span></li></ol><p class="c4 c2 c0"><span></span></p><p class="c10 c0"><span>//...<br>&lt;server&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;id&gt;TomcatServer&lt;/id&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;username&gt;admin&lt;/username&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;password&gt;admin&lt;/password&gt;<br>&lt;/server&gt;<br>//...</span></p><p class="c4 c2 c0"><span></span></p><p class="c4 c0"><span></span></p><ol class="c3 lst-kix_rb6qn9l2j41t-1 start"><li class="c8 c6 c0"><span>Finally, declare &ldquo;Maven-Tomcat plugin&rdquo; and related Tomcat server detail in your pom.xml file:</span></li></ol><p class="c2 c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c10 c0"><span>&lt;plugin&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;tomcat-maven-plugin&lt;/artifactId&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;configuration&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;url&gt;http://localhost:8080/manager&lt;/url&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;server&gt;tomcatServer&lt;/server&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;path&gt;/organization-service&lt;/path&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/configuration&gt;<br>&lt;/plugin&gt;</span></p><p class="c4 c2 c0"><span></span></p><p class="c2 c0"><span>Run </span><span class="c5">mvn tomcat:deploy </span><span>to package the project in a war file, it is then deployed in the tomcat server. To verify it, re-enter this url in the browser:</span></p><p class="c9 c0"><span class="c12 c16"><a class="c13" href="http://localhost:8088/organization-service/">http://localhost:8088/organization-service/</a></span></p><p class="c4 c2 c0"><span></span></p><ol class="c3 lst-kix_kp8mdtyzptu4-0 start"><li class="c8 c2 c0"><span class="c5">SNAACertificate implementation: </span><span>This implementation have already added in the code source of testbed-runtime. We can launch this service using the similar way that we use for others SNAA implementations in testbed.</span></li></ol><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Indeed, we can use this simple command to launch the SNAACertificate service, in the snaa directory:</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mvn exec:java -Dexec.mainClass=&quot;de.uniluebeck.itm.tr.snaSNAAServer&quot; -Dexec.args=&quot;--config snaa-certificate-shiro-mysql.properties&quot;</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>The properties file that we use here has the following content:</span></p><p class="c4 c0"><span></span></p><p class="c2 c0"><span>urnprefix &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= urn:wisebed:uzl2:</span></p><p class="c2 c0"><span>port &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 8890</span></p><p class="c2 c0"><span>snaa.type &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= CERTIFICATE</span></p><p class="c2 c0"><span>snaa.context_path &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= /soap/v3/snaa</span></p><p class="c2 c0"><span>snaa.shiro.jpa.properties_file &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= snaa-shiro-mysql.jpa.properties</span></p><p class="c4 c0"><span></span></p><h3 class="c0"><a name="h.nkg5q16u5bgf"></a><span>3.3 Launch the SNAAClient</span></h3><p class="c4 c0"><span></span></p><p class="c0"><span>To use the SNAAClient and verify the behavior of SNAACertificate, these steps are necessary:</span></p><p class="c4 c0"><span></span></p><ol class="c3 lst-kix_2sf0z1y7x5zk-0 start"><li class="c8 c2 c0"><span>Setup the two databases of SNAA and organization (see section 2) </span></li><li class="c8 c2 c0"><span>Compile the </span><span class="c5">client-certificate</span><span>, so that the jar file will be generated. It is then used by the snaa and organization service.</span></li><li class="c8 c2 c0"><span>Change the attribute </span><span class="c5">pathToKeyStoreFile</span><span>&nbsp;in the /resources/config.properties depending on your operating system:</span></li></ol><p class="c9 c0"><span>Ex: You are in Linux</span></p><p class="c2 c0"><span class="c1">#*****************************************************</span></p><p class="c2 c0"><span class="c1"># SAML Configuration</span></p><p class="c2 c0"><span class="c1">#****************************************************/</span></p><p class="c2 c0"><span class="c1"># Defaut in minute</span></p><p class="c2 c0"><span class="c1">samlMaxSessionTimeout= 10</span></p><p class="c4 c2 c0"><span class="c1"></span></p><p class="c4 c2 c0"><span class="c1"></span></p><p class="c2 c0"><span class="c1">#**********************************************************</span></p><p class="c2 c0"><span class="c1"># Key store configuration for generating SAML Assertion</span></p><p class="c2 c0"><span class="c1">#**********************************************************/</span></p><p class="c2 c0"><span class="c1">certificateAliasName=organization-alias</span></p><p class="c2 c0"><span class="c1">pathToKeyStoreFile=/home/nguyenkimthuat/Kim/FORK/testbed-runtime/snaa/certs/keystore/keystore.jks </span><span class="c1 c12"># To modify</span></p><p class="c2 c0"><span class="c1">keystorePassword=changeit</span></p><p class="c4 c2 c0"><span class="c1"></span></p><p class="c2 c0 c4"><span class="c1"></span></p><p class="c2 c0"><span class="c1">#*********************************************************</span></p><p class="c2 c0"><span class="c1"># Organization DB Configuration</span></p><p class="c2 c0"><span class="c1">#*********************************************************/</span></p><p class="c2 c0"><span class="c1">organizationDbUrl=jdbc\:mysql\://localhost\:3306/tr_organization</span></p><p class="c2 c0"><span class="c1">organizationDB_username=trorg</span></p><p class="c2 c0"><span class="c1">organizationDB_password=trorg</span></p><p class="c4 c2 c0"><span class="c1"></span></p><p class="c4 c0"><span class="c1"></span></p><p class="c2 c0"><span class="c1">#*****************************************************************</span></p><p class="c2 c0"><span class="c1"># The directory name that we use to stock the client&#39;s public key</span></p><p class="c2 c0"><span class="c1">#*****************************************************************/</span></p><p class="c2 c0"><span class="c1">clientPubKeyDirectoryName=keys</span></p><p class="c4 c0"><span></span></p><p class="c9 c0"><span>if you are on Window, this value should be:</span></p><p class="c2 c0"><span>pathToKeyStoreFile=C:\testbed-runtime\snaa\certs\keystore\keystore.jks</span></p><p class="c4 c0"><span class="c1 c12"></span></p><p class="c2 c0"><span>Note that the keystore is now saved in the directory /snaa/certs/keystore/keystore.jks for the testing purpose only, it should be located at the organization repository because it is used to generate the SAML Assertion.</span></p><p class="c4 c0"><span class="c1"></span></p><p class="c4 c0"><span class="c1"></span></p><ol class="c3 lst-kix_y8a9v7na1ktp-0 start"><li class="c8 c2 c0"><span>Set the organization-service on line using (make sure that the glassfish server is started):</span></li></ol><p class="c2 c0"><span>mvn embedded-glassfish:run</span></p><p class="c4 c2 c0"><span></span></p><ol class="c3 lst-kix_q0u5vqmi6mso-0 start"><li class="c8 c2 c0"><span>Launch the SNAACertificate service </span></li></ol><p class="c2 c0"><span>mvn exec:java -Dexec.mainClass=&quot;de.uniluebeck.itm.tr.snaa.SNAAServer&quot; -Dexec.args=&quot;--config snaa-certificate-shiro-mysql.properties&quot;</span></p><p class="c4 c0"><span></span></p><ol class="c3 lst-kix_gxulxpcr6ths-0 start"><li class="c2 c0 c8"><span>Go to client-certificate directory to test our client. To initiate the client test, use one of these two commands:</span></li></ol><p class="c4 c0"><span></span></p><ol class="c3 lst-kix_gxulxpcr6ths-1 start"><li class="c8 c6 c0"><span>To test the authentication</span></li></ol><p class="c6 c0"><span>mvn exec:java -Dexec.mainClass=&quot;eu.smartsantander.cea.utils.client.SNAAClient&quot; -Dexec.args=&quot;-authenticate cert_shiro.properties&quot;</span></p><p class="c4 c0"><span class="c12"></span></p><ol class="c3 lst-kix_bq353woles44-1 start"><li class="c8 c6 c0"><span>To test the authorization</span></li></ol><p class="c6 c0"><span>mvn exec:java -Dexec.mainClass=&quot;eu.smartsantander.cea.utils.client.SNAAClient&quot; -Dexec.args=&quot;-authorize cert_shiro.properties&quot;</span></p><p class="c4 c2 c0"><span></span></p><p class="c2 c0"><span>The file &ldquo;cert_shiro.properties&rdquo; provides some information to launch the test:</span></p><p class="c4 c2 c0"><span></span></p><p class="c6 c0"><span>userId=Administrator1</span></p><p class="c6 c0"><span>organizationId=Organization1</span></p><p class="c6 c0"><span>nodeUrnPrefix=urn:wisebed:uzl2:</span></p><p class="c6 c0"><span>nodeUrns=urn:wisebed:uzl2:0x2215,urn:wisebed:uzl2:0x2211</span></p><p class="c0 c6"><span>idpUrl=http://localhost:8088/organization-service/ProcessRequest</span></p><p class="c6 c0"><span>action=SM_GET_SUPPORTED_CHANNEL_HANDLERS</span></p><p class="c6 c0"><span>pathPrivateKey=/home/nguyenkimthuat/Kim/FORK/testbed-runtime/client-certificate/client_private_key/pkcs8_key</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>The attribute </span><span class="c5">pathPrivateKey </span><span>show the path to the client&rsquo;s private key, it is used to authenticate the client to the organization. The </span><span class="c5">idpUrl</span><span>&nbsp;is the address of the organization portail.</span></p><p class="c4 c0"><span></span></p><h2 class="c0"><a name="h.q0qgbmwmgbbj"></a><span>4. Generate certificate using keytool</span></h2><p class="c0"><span>This section describe how to use keytool to generate the certificate for the organization</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>The keytool utility stores the keys and certificates in a file that is call a keystore, a repository of certificates used for identifying a client or a server. Typically, a keystore is a file that contains one client&rsquo;s or one server&rsquo;s identity. The keystore protects private keys by using a password.</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>The general steps for creating a server certificate are as follows.</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>&nbsp;1. Create the keystore.</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>&nbsp;2. Export the certificate from the keystore.</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>&nbsp;3. Sign the certificate: We use </span><span>the </span><span>self-signed certificate</span><span>&nbsp;in the developement mode</span><span>. This step can be ignored</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>&nbsp;4. Import the certificate into a truststore: a repository of certificates from parties with which you expect to communicate or from Certificate Authorities that you trust to identify parties. The truststore is used by the client to verify the certificate that is sent by the server. A truststore typically contains more than one certificate.</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>We will give in the following section an example of generating a certificate for an organization:</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>&nbsp; &nbsp; 1. Create the keystore</span></p><p class="c0"><span>&nbsp; &nbsp; Type the keytool command all on one line:</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>&nbsp; &nbsp; keytool -genkey -alias organization-alias -keyalg RSA -keypass changeit -storepass changeit -keystore keystore.jks</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>&nbsp; &nbsp; We named here the keystore &quot;keystore.jks&quot;, and the alias &quot;organization-alias&quot;, they can be changed.</span></p><p class="c0"><span>&nbsp; &nbsp; When you press Enter, keytool prompts you to enter the server name, organizational unit, organization, locality, state, and country code.You must type the server name in response to keytool&rsquo;s &nbsp;first prompt, in which it asks for first and last names. For testing purposes, this can be anything you want.</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>&nbsp; &nbsp; In this example, we use these information:</span></p><p class="c2 c0"><span>&nbsp; &nbsp; Quels sont vos pr&eacute;nom et nom ?</span></p><p class="c2 c0"><span>&nbsp; &nbsp; &nbsp; [Unknown] : &nbsp;organization</span></p><p class="c2 c0"><span>&nbsp; &nbsp; Quel est le nom de votre unit&eacute; organisationnelle ?</span></p><p class="c2 c0"><span>&nbsp; &nbsp; &nbsp; [Unknown] : &nbsp;cea</span></p><p class="c2 c0"><span>&nbsp; &nbsp; Quelle est le nom de votre organisation ?</span></p><p class="c2 c0"><span>&nbsp; &nbsp; &nbsp; [Unknown] : &nbsp;cea</span></p><p class="c2 c0"><span>&nbsp; &nbsp; Quel est le nom de votre ville de r&eacute;sidence ?</span></p><p class="c0 c2"><span>&nbsp; &nbsp; &nbsp; [Unknown] : &nbsp;Paris, France</span></p><p class="c2 c0"><span>&nbsp; &nbsp; Quel est le nom de votre &eacute;tat ou province ?</span></p><p class="c2 c0"><span>&nbsp; &nbsp; &nbsp; [Unknown] : &nbsp;France</span></p><p class="c2 c0"><span>&nbsp; &nbsp; Quel est le code de pays &agrave; deux lettres pour cette unit&eacute; ?</span></p><p class="c2 c0"><span>&nbsp; &nbsp; &nbsp; [Unknown] : &nbsp;FR</span></p><p class="c2 c0"><span>&nbsp; &nbsp; Est-ce CN=organization, OU=cea, O=cea, L=&quot;Paris, France&quot;, ST=France, C=FR ?</span></p><p class="c2 c0"><span>&nbsp; &nbsp; &nbsp; [non] : &nbsp;oui</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>&nbsp; &nbsp; 2. Export the generated certificate in keystore.jks into the file organization.cer</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>&nbsp; &nbsp; keytool -export -alias organization-alias -storepass changeit -file organization.cer -keystore keystore.jks</span></p><p class="c4 c0"><span class="c5 c15"></span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp;3. Sign the organization certificate by CA (This step is ignored in our scenario)</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp;4. Import the certificate to a truststore so that the testbed, can verify that the organization certificate is trusted or not. To add the organization certificate to the truststore file cacerts.jks, run the following keytool command:</span></p><p class="c0"><span>keytool -import -v -trustcacerts -alias organization-alias<br>-file organization.cer -keystore cacerts.jks -keypass changeit -storepass changeit</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>Information on the certificate, such as that shown next, will appear:</span></p><p class="c4 c0"><span></span></p><p class="c2 c0"><span>Propri&eacute;taire : CN=organization, OU=cea, O=cea, L=&quot;Paris, France&quot;, ST=France, C=FR</span></p><p class="c2 c0"><span>&Eacute;metteur : CN=organization, OU=cea, O=cea, L=&quot;Paris, France&quot;, ST=France, C=FR</span></p><p class="c2 c0"><span>Num&eacute;ro de s&eacute;rie : 5204aadd</span></p><p class="c2 c0"><span>Valide du : Fri Aug 09 10:39:57 CEST 2013 au : Thu Nov 07 09:39:57 CET 2013</span></p><p class="c2 c0"><span>Empreintes du certificat :</span></p><p class="c2 c0"><span>&nbsp; &nbsp; &nbsp;MD5 : &nbsp;9D:8C:0F:74:65:D9:86:62:B9:5D:BA:ED:61:AC:AC:4F</span></p><p class="c2 c0"><span>&nbsp; &nbsp; &nbsp;SHA1 : 09:03:0C:4A:51:BE:70:83:4A:70:F3:A2:E6:49:45:00:53:C9:8D:43</span></p><p class="c2 c0"><span>&nbsp; &nbsp; &nbsp;Nom de lalgorithme de signature : {7}</span></p><p class="c2 c0"><span>&nbsp; &nbsp; &nbsp;Version : {8}</span></p><p class="c2 c0"><span>Faire confiance &agrave; ce certificat ? [non] :</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>&nbsp; 5. Type yes and press enter or return key</span></p><p class="c4 c0"><span></span></p><p class="c2 c0"><span>Certificat ajout&eacute; au Keystore</span></p><p class="c2 c0"><span>[Stockage de cacerts.jks]</span></p><p class="c4 c2 c0"><span></span></p><p class="c4 c2 c0"><span></span></p><p class="c4 c0"><span></span></p><div><p class="c4 c7 c0"><span></span></p></div></body></html>